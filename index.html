<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Agent DQN Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 12px 24px;
            background: #f5f5f5;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .tab:hover {
            background: #764ba2;
            color: white;
        }
        
        .diagram-section {
            display: none;
        }
        
        .diagram-section.active {
            display: block;
        }
        
        .architecture-diagram {
            display: flex;
            flex-direction: column;
            gap: 30px;
            padding: 20px;
        }
        
        .layer {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .layer-title {
            min-width: 180px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .layer-content {
            flex: 1;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .node {
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }
        
        .node:hover {
            transform: translateY(-5px);
        }
        
        .env { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .state { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .input { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .hidden { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .output { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .action { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
        .reward { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }
        .buffer { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: #333; }
        .train { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #333; }
        
        .arrow {
            font-size: 30px;
            color: #7f8c8d;
        }
        
        .network-visual {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 30px;
            background: linear-gradient(135deg, #e0f7fa 0%, #e1bee7 100%);
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .network-layer {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }
        
        .network-layer-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .neuron {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .connection {
            width: 80px;
            height: 2px;
            background: #bbb;
            align-self: center;
        }
        
        .info-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }
        
        .info-box h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .info-box ul {
            margin-left: 20px;
        }
        
        .info-box li {
            margin: 5px 0;
            color: #555;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
        }
        
        .flow-diagram {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .flow-step {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .step-number {
            min-width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .step-content {
            flex: 1;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .step-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .step-desc {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Multi-Agent DQN Architecture</h1>
        <p class="subtitle">Phase 2: 4 Agents Learning to Coordinate in 5√ó5 Grid</p>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">Overview</button>
            <button class="tab" onclick="showTab('network')">Neural Network</button>
            <button class="tab" onclick="showTab('training')">Training Loop</button>
            <button class="tab" onclick="showTab('components')">Components</button>
        </div>
        
        <!-- Overview Tab -->
        <div id="overview" class="diagram-section active">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">üéØ System Overview</h2>
            
            <div class="architecture-diagram">
                <div class="layer">
                    <div class="layer-title">1. Environment</div>
                    <div class="arrow">‚Üí</div>
                    <div class="layer-content">
                        <div class="node env">5√ó5 Grid World</div>
                        <div class="node env">4 Agents</div>
                        <div class="node env">Locations A & B</div>
                    </div>
                </div>
                
                <div class="layer">
                    <div class="layer-title">2. State</div>
                    <div class="arrow">‚Üí</div>
                    <div class="layer-content">
                        <div class="node state">Position (x, y)</div>
                        <div class="node state">Has Item (0/1)</div>
                        <div class="node state">Distance to Target</div>
                    </div>
                </div>
                
                <div class="layer">
                    <div class="layer-title">3. DQN Network</div>
                    <div class="arrow">‚Üí</div>
                    <div class="layer-content">
                        <div class="node input">Input: 4 features</div>
                        <div class="node hidden">Hidden: [128, 64]</div>
                        <div class="node output">Output: 4 Q-values</div>
                    </div>
                </div>
                
                <div class="layer">
                    <div class="layer-title">4. Action Selection</div>
                    <div class="arrow">‚Üí</div>
                    <div class="layer-content">
                        <div class="node action">UP</div>
                        <div class="node action">DOWN</div>
                        <div class="node action">LEFT</div>
                        <div class="node action">RIGHT</div>
                    </div>
                </div>
                
                <div class="layer">
                    <div class="layer-title">5. Rewards</div>
                    <div class="arrow">‚Üí</div>
                    <div class="layer-content">
                        <div class="node reward">Pickup: +1</div>
                        <div class="node reward">Delivery: +10</div>
                        <div class="node reward">Step: -0.1</div>
                        <div class="node reward">Collision: -10</div>
                    </div>
                </div>
                
                <div class="layer">
                    <div class="layer-title">6. Experience Replay</div>
                    <div class="arrow">‚Üí</div>
                    <div class="layer-content">
                        <div class="node buffer">Store (s,a,r,s')</div>
                        <div class="node buffer">Capacity: 10k</div>
                        <div class="node buffer">Sample: 64</div>
                    </div>
                </div>
                
                <div class="layer">
                    <div class="layer-title">7. Training</div>
                    <div class="arrow">‚Üí</div>
                    <div class="layer-content">
                        <div class="node train">Compute Loss</div>
                        <div class="node train">Backpropagate</div>
                        <div class="node train">Update Weights</div>
                    </div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Parameters</div>
                    <div class="stat-value">9,156</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Hidden Layers</div>
                    <div class="stat-value">2</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Buffer Capacity</div>
                    <div class="stat-value">10,000</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Batch Size</div>
                    <div class="stat-value">64</div>
                </div>
            </div>
        </div>
        
        <!-- Neural Network Tab -->
        <div id="network" class="diagram-section">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">üß† Neural Network Architecture</h2>
            
            <div class="network-visual">
                <div class="network-layer">
                    <div class="network-layer-title">Input Layer<br>(4 neurons)</div>
                    <div class="neuron">x</div>
                    <div class="neuron">y</div>
                    <div class="neuron">i</div>
                    <div class="neuron">d</div>
                </div>
                
                <div class="connection"></div>
                
                <div class="network-layer">
                    <div class="network-layer-title">Hidden Layer 1<br>(128 neurons)</div>
                    <div class="neuron">‚Ä¢</div>
                    <div class="neuron">‚Ä¢</div>
                    <div class="neuron">‚Ä¢</div>
                    <div class="neuron">‚Ä¢</div>
                    <div class="neuron">‚Ä¢</div>
                    <div style="margin: 5px 0;">...</div>
                    <div class="neuron">‚Ä¢</div>
                    <div class="neuron">‚Ä¢</div>
                </div>
                
                <div class="connection"></div>
                
                <div class="network-layer">
                    <div class="network-layer-title">Hidden Layer 2<br>(64 neurons)</div>
                    <div class="neuron">‚Ä¢</div>
                    <div class="neuron">‚Ä¢</div>
                    <div class="neuron">‚Ä¢</div>
                    <div class="neuron">‚Ä¢</div>
                    <div style="margin: 5px 0;">...</div>
                    <div class="neuron">‚Ä¢</div>
                </div>
                
                <div class="connection"></div>
                
                <div class="network-layer">
                    <div class="network-layer-title">Output Layer<br>(4 neurons)</div>
                    <div class="neuron">‚Üë</div>
                    <div class="neuron">‚Üì</div>
                    <div class="neuron">‚Üê</div>
                    <div class="neuron">‚Üí</div>
                </div>
            </div>
            
            <div class="info-box">
                <h3>Network Details</h3>
                <ul>
                    <li><strong>Input:</strong> [x_position, y_position, has_item, distance_to_target]</li>
                    <li><strong>Layer 1:</strong> Linear(4 ‚Üí 128) + ReLU activation</li>
                    <li><strong>Layer 2:</strong> Linear(128 ‚Üí 64) + ReLU activation</li>
                    <li><strong>Output:</strong> Linear(64 ‚Üí 4) = Q-values for [UP, DOWN, LEFT, RIGHT]</li>
                    <li><strong>Total Parameters:</strong> (4√ó128 + 128) + (128√ó64 + 64) + (64√ó4 + 4) = 9,156</li>
                </ul>
            </div>
            
            <div class="info-box">
                <h3>‚ö° Forward Pass Example</h3>
                <ul>
                    <li><strong>Input State:</strong> [2.0, 3.0, 0.0, 5.0] (Agent at (2,3), no item, distance=5)</li>
                    <li><strong>After Layer 1:</strong> 128 neurons activated with ReLU</li>
                    <li><strong>After Layer 2:</strong> 64 neurons activated with ReLU</li>
                    <li><strong>Output Q-values:</strong> [0.246, 0.239, -0.044, 0.205]</li>
                    <li><strong>Best Action:</strong> UP (Q=0.246)</li>
                </ul>
            </div>
        </div>
        
        <!-- Training Loop Tab -->
        <div id="training" class="diagram-section">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">üîÑ Training Loop Flow</h2>
            
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">Reset Environment</div>
                        <div class="step-desc">Initialize 4 agents at starting positions, reset metrics</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">Observe State</div>
                        <div class="step-desc">Get state for each agent: [x, y, has_item, distance]</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">Select Actions (Œµ-greedy)</div>
                        <div class="step-desc">If random() < Œµ: random action, else: argmax Q(s,a)</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <div class="step-title">Execute Actions</div>
                        <div class="step-desc">Move agents, check collisions, update positions</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <div class="step-title">Compute Rewards</div>
                        <div class="step-desc">Pickup: +1, Delivery: +10, Step: -0.1, Collision: -10</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">6</div>
                    <div class="step-content">
                        <div class="step-title">Store Experience</div>
                        <div class="step-desc">Add (state, action, reward, next_state, done) to replay buffer</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">7</div>
                    <div class="step-content">
                        <div class="step-title">Sample Mini-batch</div>
                        <div class="step-desc">Randomly sample 64 experiences from buffer</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">8</div>
                    <div class="step-content">
                        <div class="step-title">Compute Target Q-values</div>
                        <div class="step-desc">Target = r + Œ≥ √ó max Q_target(s', a')</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">9</div>
                    <div class="step-content">
                        <div class="step-title">Compute Loss</div>
                        <div class="step-desc">Loss = MSE(Q_predicted, Q_target)</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">10</div>
                    <div class="step-content">
                        <div class="step-title">Backpropagation</div>
                        <div class="step-desc">Compute gradients and update policy network weights</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">11</div>
                    <div class="step-content">
                        <div class="step-title">Update Target Network</div>
                        <div class="step-desc">Every 1000 steps: Œ∏_target ‚Üê Œ∏_policy</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">12</div>
                    <div class="step-content">
                        <div class="step-title">Decay Epsilon</div>
                        <div class="step-desc">Œµ ‚Üê max(Œµ_min, Œµ √ó decay_rate)</div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">13</div>
                    <div class="step-content">
                        <div class="step-title">Repeat Until Convergence</div>
                        <div class="step-desc">Continue until >95% success rate achieved</div>
                    </div>
                </div>
            </div>
            
            <div class="info-box">
                <h3>üìä Training Hyperparameters</h3>
                <ul>
                    <li><strong>Learning Rate (Œ±):</strong> 0.001</li>
                    <li><strong>Discount Factor (Œ≥):</strong> 0.99</li>
                    <li><strong>Epsilon Start:</strong> 1.0 (100% exploration)</li>
                    <li><strong>Epsilon End:</strong> 0.01 (1% exploration)</li>
                    <li><strong>Epsilon Decay:</strong> 0.995 per episode</li>
                    <li><strong>Batch Size:</strong> 64 experiences</li>
                    <li><strong>Replay Buffer:</strong> 10,000 capacity</li>
                    <li><strong>Target Update:</strong> Every 1,000 steps</li>
                </ul>
            </div>
        </div>
        
        <!-- Components Tab -->
        <div id="components" class="diagram-section">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">üîß System Components</h2>
            
            <div class="info-box">
                <h3>1Ô∏è‚É£ Environment (environment.py)</h3>
                <ul>
                    <li><strong>Grid:</strong> 5√ó5 discrete space</li>
                    <li><strong>Agents:</strong> 4 independent agents</li>
                    <li><strong>Locations:</strong> A (0,0) pickup, B (4,4) dropoff</li>
                    <li><strong>Actions:</strong> UP, DOWN, LEFT, RIGHT (no WAIT)</li>
                    <li><strong>Collision Detection:</strong> Checks position overlap</li>
                    <li><strong>State Space:</strong> 4 features per agent √ó 4 agents = 16D</li>
                </ul>
            </div>
            
            <div class="info-box">
                <h3>2Ô∏è‚É£ DQN Network (dqn.py)</h3>
                <ul>
                    <li><strong>Framework:</strong> PyTorch</li>
                    <li><strong>Architecture:</strong> 4 ‚Üí [128, 64] ‚Üí 4</li>
                    <li><strong>Activation:</strong> ReLU for hidden layers</li>
                    <li><strong>Output:</strong> Raw Q-values (no activation)</li>
                    <li><strong>Parameters:</strong> 9,156 trainable weights</li>
                    <li><strong>Device:</strong> CPU (GPU optional)</li>
                </ul>
            </div>
            
            <div class="info-box">
                <h3>3Ô∏è‚É£ Replay Buffer (replay_buffer.py)</h3>
                <ul>
                    <li><strong>Structure:</strong> Deque (FIFO)</li>
                    <li><strong>Capacity:</strong> 10,000 experiences</li>
                    <li><strong>Experience:</strong> (state, action, reward, next_state, done)</li>
                    <li><strong>Sampling:</strong> Random mini-batch (64)</li>
                    <li><strong>Purpose:</strong> Break temporal correlation</li>
                    <li><strong>Multi-Agent:</strong> Supports shared/independent buffers</li>
                </ul>
            </div>
            
            <div class="info-box">
                <h3>4Ô∏è‚É£ DQN Agent (agent.py)</h3>
                <ul>
                    <li><strong>Policy Network:</strong> Main learning network</li>
                    <li><strong>Target Network:</strong> Stable Q-value estimation</li>
                    <li><strong>Optimizer:</strong> Adam (lr=0.001)</li>
                    <li><strong>Loss Function:</strong> MSE (Mean Squared Error)</li>
                    <li><strong>Exploration:</strong> Epsilon-greedy policy</li>
                    <li><strong>Gradient Clipping:</strong> Max norm = 1.0</li>
                </ul>
            </div>
            
            <div class="info-box">
                <h3>5Ô∏è‚É£ Training Loop (train.py - Day 5)</h3>
                <ul>
                    <li><strong>Episodes:</strong> 1,000 training episodes</li>
                    <li><strong>Max Steps:</strong> 1,500 total budget</li>
                    <li><strong>Max Collisions:</strong> 4 during training</li>
                    <li><strong>Logging:</strong> Loss, rewards, metrics</li>
                    <li><strong>Checkpoints:</strong> Save best models</li>
                    <li><strong>Visualization:</strong> Plots and graphs</li>
                </ul>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Files Created</div>
                    <div class="stat-value">5</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Lines of Code</div>
                    <div class="stat-value">~1,000</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Test Coverage</div>
                    <div class="stat-value">100%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Success Rate Target</div>
                    <div class="stat-value">>95%</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function showTab(tabName) {
            // Hide all sections
            const sections = document.querySelectorAll('.diagram-section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected section
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }
    </script>
</body>
</html>